<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
xmlns:atom="http://www.w3.org/2005/Atom"
xmlns:wfw="http://wellformedweb.org/CommentAPI/">
<channel>
<title>dhui&#039;s Blog</title>
<link>https://dhui626.github.io/</link>
<atom:link href="https://dhui626.github.io/index.php/feed/" rel="self" type="application/rss+xml" />
<language>zh-CN</language>
<description>こっちみんな！</description>
<lastBuildDate>Tue, 19 Nov 2024 15:32:38 +0000</lastBuildDate>
<pubDate>Tue, 19 Nov 2024 15:32:38 +0000</pubDate>
<item>
<title>基于 OpenGL 的 Minecraft 世界渲染器</title>
<link>https://dhui626.github.io/index.php/archives/73/</link>
<guid>https://dhui626.github.io/index.php/archives/73/</guid>
<pubDate>Tue, 19 Nov 2024 15:32:38 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[本页面用于项目《基于 OpenGL 的 Minecraft 世界渲染器》展示。渲染器基于 C++ 与 OpenGL，由本人独立完成。（2024.10.1~至今）截至目前的最终渲染结果如下下面按时...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>本页面用于项目《基于 OpenGL 的 Minecraft 世界渲染器》展示。</p><p>渲染器基于 C++ 与 OpenGL，由本人独立完成。（2024.10.1~至今）</p><p><strong>截至目前的最终渲染结果如下</strong></p><p><figure><img class="" alt="Final" data-src="https://dhui626.github.io/pics/Final.png" src="https://dhui626.github.io/pics/Final.png"><figcaption>Final</figcaption></figure></p><p>下面按时间顺序来展示各阶段进行的工作与结果。</p><h2 id="toc_0">OpenGL 基础功能</h2><p>一切的开始！起初这只是一个 OpenGL 学习项目（直到现在项目目录都是LearnOpenGL）</p><p><figure><img class="" alt="Stage1-1" data-src="https://dhui626.github.io/pics/Stage1-1.png" src="https://dhui626.github.io/pics/Stage1-1.png"><figcaption>Stage1-1</figcaption></figure></p><p>用 OpenGL 渲染一个草方块，并编写 shader 应用 Blinn-Phong 光照模型。</p><p>后面发现了很多问题并修正：</p><ol><li>纹理图案在边界处异常，原因是下载的纹理图案有模糊处理，替换成原图后正常。</li><li>当时实现的实际是 Phong 光照模型，specular 分量的计算未用到半程向量，后修正（顺便一提，GAMES202 的作业框架也存在此错误，且作业1中 specular 颜色值传入了 0，实际计算出的 specular 分量为 0，可能就因此没被助教们发现？）</li></ol><p><figure><img class="" alt="Stage1-2" data-src="https://dhui626.github.io/pics/Stage1-2.png" src="https://dhui626.github.io/pics/Stage1-2.png"><figcaption>Stage1-2</figcaption></figure></p><p>实现基于 Perlin 噪声的区块生成器，并启用 ImGui 进行调试。场景中只有单个区块(32×32)。</p><p>至此性能问题就被充分暴露了：由于我每个方块都调用了一次draw call，因此上面的简单场景也只有10hz，如果场景中有多个区块将是个灾难。</p><h2 id="toc_1">性能优化</h2><p>主要的优化步骤总结为如下三步：</p><ol><li>每个区块类内维护一个 VAO，在渲染该区块时只执行一次draw call</li><li>只对接触到空气的面加入到 vertex 和 indices 数组，实际很多面不需要绘制（藏在泥土中的，以及两个相邻方块的接触面）。</li><li>启用背面剔除</li></ol><p>在解决了以上问题后，可以生成多个区块了，并加入了 GAMES202 中介绍的阴影算法（shadow map, PCF, PCSS）</p><p><figure><img class="" alt="Stage2-1" data-src="https://dhui626.github.io/pics/Stage2-1.png" src="https://dhui626.github.io/pics/Stage2-1.png"><figcaption>Stage2-1</figcaption></figure></p><p>在图下方的方块边缘处阴影缺了一块，这与修复 Shadow Acne 设置的 bias 有关。</p><p><figure><img class="" alt="Stage2-2" data-src="https://dhui626.github.io/pics/Stage2-2.png" src="https://dhui626.github.io/pics/Stage2-2.png"><figcaption>Stage2-2</figcaption></figure></p><p>修正世界生成逻辑，改用 Simplex 噪声，并添加了花草，结果如上图。</p><p>考虑到花草和方块的渲染逻辑不同，后续也会使用不同的 shader ，本人将代码进行了重构。重构后一个区块可拥有多个 VAO ，且花草、方块以及后面加入的水面可以用不同的 shader 来渲染。</p><p><figure><img class="" alt="Stage2-3" data-src="https://dhui626.github.io/pics/Stage2-3.png" src="https://dhui626.github.io/pics/Stage2-3.png"><figcaption>Stage2-3</figcaption></figure></p><p>加入水方块，并对水流使用不同的渲染逻辑(透明物体最后渲染)，并在 vertex shader 中模拟水的流动(Gerstner waves)</p><h2 id="toc_2">后处理</h2><p>后处理主要在屏幕空间完成，即利用 FBO 的渲染结果以及深度进行图像处理。</p><p><figure><img class="" alt="Stage3-1" data-src="https://dhui626.github.io/pics/Stage3-1.png" src="https://dhui626.github.io/pics/Stage3-1.png"><figcaption>Stage3-1</figcaption></figure></p><p>水上雾化效果和水中漫游效果(Screen Space Fog)，利用 FBO 的深度值来计算混合颜色。</p><p><figure><img class="" alt="Stage3-2" data-src="https://dhui626.github.io/pics/Stage3-2.png" src="https://dhui626.github.io/pics/Stage3-2.png"><figcaption>Stage3-2</figcaption></figure></p><p>Bloom效果展示。</p><p>除此之外，还加入了以下调节：亮度、对比度、饱和度、锐度(已移除)、Gamma校正等</p><p><figure><img class="" alt="Stage3-3" data-src="https://dhui626.github.io/pics/Stage3-3.png" src="https://dhui626.github.io/pics/Stage3-3.png"><figcaption>Stage3-3</figcaption></figure></p><p>Tone Mapping，实现并比较了各种方法的结果，个人比较喜欢 CE 和 Filmic 。</p><h2 id="toc_3">总结</h2><p>以上就是本人的 Minecraft Mini Renderer 的暂时进展。后续会加入更多内容，如 Cascade Shadow Map，MSAA，玩家模型等，本页面也将持续更新。</p><p>GitHub 链接（可能是private）：<a href="https://github.com/dhui626/LearnOpenGL">https://github.com/dhui626/LearnOpenGL</a></p><p><figure><img class="" alt="Git" data-src="https://dhui626.github.io/pics/Git.png" src="https://dhui626.github.io/pics/Git.png"><figcaption>Git</figcaption></figure></p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/73/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>Blender 学习记录</title>
<link>https://dhui626.github.io/index.php/archives/71/</link>
<guid>https://dhui626.github.io/index.php/archives/71/</guid>
<pubDate>Mon, 24 Jun 2024 14:50:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[填坑，使用 Blender4.0 官网下载链接，参考Blender Guru 的教程文章主图是最终渲染图片。快捷方式鼠标滚轮按下: 调整视角Shift + 鼠标滚轮按下: 移动视角Shift +...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>填坑，使用 Blender4.0 <a href="https://www.blender.org/download/">官网下载链接</a>，参考<a href="https://www.youtube.com/playlist?list=PLjEaoINr3zgEPv5y--4MKpciLaoQYZB1Z">Blender Guru 的教程</a></p><h2 id="toc_4">文章主图是最终渲染图片。</h2><h3 id="toc_5">快捷方式</h3><p>鼠标滚轮按下: 调整视角</p><p>Shift + 鼠标滚轮按下: 移动视角</p><p>Shift + A: 添加物体</p><p>G (grab): 移动物体</p><p>G + X/Y/Z: 沿坐标轴X/Y/Z移动物体</p><p>G + 鼠标滚轮按下: 沿某一坐标轴移动物体</p><p>0: 摄像机视角</p><p>N: 选项(常用于关掉那个窗口)</p><p>S (scale) + X/Y/Z: 缩放物体</p><p>R (rotate) + X/Y/Z: 旋转物体</p><h3 id="toc_6">形状编辑</h3><p>网格细分：添加修改器 - 生成 - 表面细分 - 调节Catmull-Clark细分的层数</p><p>编辑网格细节：选中物体 - 左上角物体模式 - 编辑模式 （快捷键Tab）</p><p>衰减编辑：同时改变一系列点。滚轮控制点的范围（P2P变形的参数）</p><p>切换透视模式：选框操作时可以选择物体背后的点</p><p>解决网格重叠的渲染问题：修改器 - 生成 - 实体化 - 调节偏移量</p><p>固定网格的部分点并隐藏：alt + 鼠标点击: 选中   ctrl + : 扩大范围  H: 隐藏</p><p>添加新顶点：选中部分点，E + 鼠标拖动</p><p>让网格顶点落在另一个网格上，而不重叠：修改器 - 形变 - 缩裹，并指定特定的目标</p><p>雕刻模式：左上角切换，常用：膨胀(I) 抓起(G)</p><p>遮罩(Mask)：快捷键 M，选定不进行雕刻的区域。Ctrl + I：反选。遮罩 - 平滑遮罩：将Mask平滑化。</p><p>绑定两个物体：先选子对象（跟着父对象移动的），再选父对象，快捷键 Ctrl + P - 物体(保持变换)</p><p>选中面 - Ctrl+B：斜面工具，常用于将尖锐的边光滑化，在编辑时操作滚轮控制层数。</p><p>选中顶点 - Ctrl+R：在网格中建立细分</p><p>修改器 - 形变 - 简易形变：将网格进行拉伸、缩小</p><p>去除网格重复点：A(全选) + M(Merge) - 按距离</p><p>移动物体时吸附：G + B，点击对应的点，过程中使用 Alt + 滚轮 调整视角</p><p>重新计算法线：选中面 - Shift+N - 勾选向内</p><h3 id="toc_7">材质与渲染</h3><p>材质 - 添加材质 - 修改颜色、糙度等等。</p><p>材质下载：<a href="https://www.poliigon.com/">Poliigon</a>，网站有 add-on 安装教程。</p><p>Texture Paint：进行网格纹理的绘制，局部视图：快捷键 / </p><p>几何节点(Geometry Nodes)：对网格进行自定义修改，过于复杂。<a href="https://www.youtube.com/watch?v=TLrA6eJOfqk">视频</a></p><p>视图 - 裁剪起始：相机靠近物体太近时会穿过物体，调为最小(0.001m)可解决。</p><p>Fly模式：Shift+`，第一人称视角观察，WASD移动/QE上升下降等</p><p>更改物体不同部位的材质：建立多个材质</p><p>环境光添加：World - 颜色 - 天空纹理</p><p>亮度调节：Scene - 胶片 - 曝光度 （也可在环境光设置中调节）</p><p>滤镜添加：渲染 - 色彩管理 - 胶片效果（）</p><p>后处理：Compositing - 勾选“使用节点” - 添加节点(色彩平衡, etc)</p><p>开始渲染：渲染 - 渲染动画(Ctrl + F12)</p><p>景深设置：选中相机 - 勾选景深，并调节光圈级数</p><h3 id="toc_8">动画</h3><p>I (insert): 添加关键帧</p><p>曲线编辑：Animation - 曲线编辑器 - 编辑Bezier曲线</p><p>曲线尺度的调整：HOME键 / Ctrl + 按下鼠标滚轮</p><p>输出格式调整：输出 - 文件格式 - PNG（不建议直接生成视频，如果渲染中计算机意外重启可能丢失所有进度）</p><p><strong>视频生成</strong></p><p>文件 - 新建 - 视频编辑（或在当前项目中添加“视频编辑”工作区）</p><p>输出 - 文件格式 - FFmpeg视频 - 编码设置等</p><p>输出 - 后期处理 - 勾选序列编辑器（合成处理选项也可以在这里开关）</p><p>添加 - 图像序列</p><p><strong>视频后处理</strong></p><p><a href="https://app.clipchamp.com/">Clipchamp</a> : 剪辑视频，提取音频，提取字幕等</p><p>分离人声 : <a href="https://vocalremover.org/">https://vocalremover.org/</a></p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/71/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>B-spline 插值 自然边界条件证明</title>
<link>https://dhui626.github.io/index.php/archives/51/</link>
<guid>https://dhui626.github.io/index.php/archives/51/</guid>
<pubDate>Wed, 01 Nov 2023 06:50:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[B-spline 插值 自然边界条件证明定理： 四阶(三次) B-spline 插值 的自然边界条件可以简化成如下方程组：$$\frac{\textbf{d}_{2}-\textbf{d}_{1...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<h1>B-spline 插值 自然边界条件证明</h1><p><strong>定理：</strong> 四阶(三次) B-spline 插值 的自然边界条件可以简化成如下方程组：</p><p>$$
\frac{\textbf{d}_{2}-\textbf{d}_{1}}{t_{2}-t_{0}} = \frac{\textbf{d}_{1}-\textbf{d}_{0}}{t_{1}-t_{0}} \\
\frac{\textbf{d}_{n+2}-\textbf{d}_{n+1}}{t_{n}-t_{n-1}} = \frac{\textbf{d}_{n+1}-\textbf{d}_{n}}{t_{n}-t_{n-2}}
$$</p><p><strong>证明</strong>：$N_{i,k}(t)$ 参考老师 ppt 的定义，$k$ 是阶数。它的导数为</p><p>$$
N&#039;_{i,k}(t) = \frac{k}{t_{i+k}-t_i}N_{i,k-1}(t) - \frac{k}{t_{i+k+1}-t_{i+1}}N_{i+1,k-1}(t)
$$</p><p>证明见 <a href="http://mat.fsv.cvut.cz/gcg/sbornik/prochazkova.pdf">Reference1</a> ，使用了数学归纳法。故 B-spline 的一阶导数为：</p><p>$$
x(t) = \sum_{i=0}^n N_{i,k}(t) \textbf{d}_i \\
x&#039;(t) = \sum_{i=0}^{n-1} N_{i+1,k-1}(t) \textbf{Q}_i \\
\textbf{Q}_i = \frac{k}{t_{i+k+1}-t_{i+1}}(\textbf{d}_{i+1}-\textbf{d}_{i})
$$</p><p>推导见 <a href="https://public.vrac.iastate.edu/~oliver/courses/me625/week5b.pdf">Reference2</a> 。然后可以写出二阶导数的形式如下。</p><p>$$
x&#039;&#039;(t) = \sum_{i=0}^{n-2} N_{i+2,k-2}(t) \textbf{R}_i \\
\textbf{R}_i = \frac{k-1}{t_{i+k+1}-t_{i+2}}(\textbf{Q}_{i+1}-\textbf{Q}_{i})
$$</p><p>在 B-spline 插值问题中，$k = 4$。指标从 -3 开始。求和范围和 $\textbf{d}_{i}$ 的指标需要相应改变，其他不需要。</p><p>$$
x(t) = \sum_{i=-3}^{n-1} N_{i,4}(t) \textbf{d}_{i+3} \\
x&#039;(t) = \sum_{i=-3}^{n-2} N_{i+1,3}(t) \textbf{Q}_{i} \\
x&#039;&#039;(t) = \sum_{i=-3}^{n-3} N_{i+2,2}(t) \textbf{R}_{i} \\
$$</p><p>因为 $N_{i,2}(t)$ 只在 $(t_i,t_{i+2})$ 区间非零，边界条件 $x&#039;&#039;(t_0)=0$ 等价于如下形式。</p><p>$$
N_{-1,2}(t_0)\textbf{R}_{-3}=0
$$</p><p>根据 $\textbf{R}_{i}$ 的表达式，边界条件等价于</p><p>$$
\textbf{Q}_{-2}=\textbf{Q}_{-3} \\
$$</p><p>等价于</p><p>$$
\frac{\textbf{d}_{2}-\textbf{d}_{1}}{t_{3}-t_{-1}} = \frac{\textbf{d}_{1}-\textbf{d}_{0}}{t_{2}-t_{-2}}
$$</p><p>由重结点定义，$t_{-1} = t_{-2} = t_{0}$ ，得到所需的边界条件。 </p><p>在 $t_n$ 处的自然边界条件也能用同样的方法算出。</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/51/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>Linux初上手记录</title>
<link>https://dhui626.github.io/index.php/archives/25/</link>
<guid>https://dhui626.github.io/index.php/archives/25/</guid>
<pubDate>Sat, 28 Oct 2023 17:19:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[当时并没有详细记录的意识，只记录了相关代码，某些步骤现在已经看不懂了xwsl命令备份还原wsl --export Ubuntu C:\OWO\CloudMusic\wslbkp.tarwsl -...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>当时并没有详细记录的意识，只记录了相关代码，某些步骤现在已经看不懂了x</p><p><strong>wsl命令</strong></p><p>备份还原</p><pre><code>wsl --export Ubuntu C:\OWO\CloudMusic\wslbkp.tar
wsl --import Ubuntu C:\CloudMusic C:\OWO\CloudMusic\wslbkp.tar</code></pre><p>卸载子系统</p><pre><code>wsl --list --all
wsl --unregister Ubuntu</code></pre><p>安装桌面 gnome（失败）</p><pre><code>sudo apt-get install ubuntu-desktop gnome</code></pre><p>安装 systemd（失败）</p><pre><code>git clone https://github.com/DamionGans/ubuntu-wsl2-systemd-script.git
cd ubuntu-wsl2-systemd-script/</code></pre><p>修改 enter-systemd-namespace <a href="https://github.com/DamionGans/ubuntu-wsl2-systemd-script/issues/36">参考</a></p><pre><code>bash ubuntu-wsl2-systemd-script.sh     //系统会崩溃</code></pre><p>设置默认Linux开发版</p><pre><code>wslconfig /setdefault Ubuntu-20.04</code></pre><p>配置代理（Clash开启允许局域网连接）</p><pre><code>export hostip=$(cat /etc/resolv.conf |grep -oP &#039;(?&lt;=nameserver\ ).*&#039;);
export https_proxy=&quot;http://${hostip}:7890&quot;;
export http_proxy=&quot;http://${hostip}:7890&quot;;
export all_proxy=&quot;socks5://${hostip}:7891&quot;;</code></pre><p>git 通过代理</p><pre><code>git clone -c http.proxy=&quot;http://127.0.0.1:1080&quot; https://github.com/TIGERB/easy-php.git</code></pre><p>apt相关</p><pre><code>sudo apt -o Acquire::http::proxy=&quot;http://${hostip}:7890&quot; install nvidia-cuda-toolkit
sudo apt search libdc1394
sudo apt install 
sudo apt purge libopencv-dev python3-opencv
sudo apt autoremove</code></pre><p>OpenCV（2.4.11 3.2.0均编译失败，而3.4.5可以无错误编译，<a href="https://github.com/Itseez/opencv/archive/3.4.5.zip">下载链接</a>）<br><a href="https://blog.csdn.net/hltt3838/article/details/113962104">参考</a></p><p>编译用代码</p><pre><code>mkdir build &amp;&amp; cd build
cmake ..
make -j8
sudo make install
sudo ldconfig</code></pre><p>窗口显示<br>VcXsvr 勾上 Disable access control 选项</p><pre><code>nano ~/.bashrc</code></pre><p>最后加上</p><pre><code>export DISPLAY=`grep -oP &quot;(?&lt;=nameserver ).+&quot; /etc/resolv.conf`:0.0</code></pre><p>刷新shell的配置</p><pre><code>source ~/.bashrc</code></pre><p>Draft</p><pre><code>netsh int ipv4 set dynamic tcp start=49152 num=16384</code></pre><p><strong>相关教程资料</strong></p><p><a href="https://wiki.ubuntu.org.cn/Ubuntu%E6%A1%8C%E9%9D%A2%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97">Ubuntu桌面入门指南</a></p><p><a href="https://sspai.com/post/43813">不用装双系统，直接在 Windows 上体验 Linux：Windows Subsystem for Linux - 少数派</a></p><p><a href="https://blacksand.top/2021/12/03/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E2%94%80%E2%94%80%E5%A6%82%E4%BD%95%E5%9C%A8Linux%E4%B8%8A%E6%B8%B8%E7%8E%A9osu!stable/">快速上手──在 Linux 上游玩 osu!stable | 砂糖砂糖沙</a></p><p><a href="https://blog.csdn.net/hltt3838/article/details/113962104">ORB-SLAM2 “工具安装 和 系统运行“ 详细过程</a></p><p><a href="https://github.com/DEEPIR/ElasticFusion">GitHub - DEEPIR/ElasticFusion</a></p><p><a href="https://codeantenna.com/a/y4IHTfrdz5">ElasticFusion的编译 - CodeAntenna</a></p><p><a href="http://blog.leanote.com/post/gaunthan/Windows-10-WSL2-%E6%98%BE%E7%A4%BA-Matplotlib-%E5%9B%BE%E5%83%8F">Windows 10, WSL2 显示 GUI 窗口</a></p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/25/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>Visual Studio 踩坑记录</title>
<link>https://dhui626.github.io/index.php/archives/24/</link>
<guid>https://dhui626.github.io/index.php/archives/24/</guid>
<pubDate>Sat, 28 Oct 2023 17:04:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[运行环境：Windows 10 22H2 x64 + Visual Studio 2022vcpkgvcpkg 是 Microsoft 的跨平台开源软件包管理器，极大地简化了 Windows、L...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>运行环境：Windows 10 22H2 x64 + Visual Studio 2022</p><h2 id="toc_9">vcpkg</h2><p>vcpkg 是 Microsoft 的跨平台开源软件包管理器，极大地简化了 Windows、Linux 和 macOS 上第三方库的配置与安装。<a href="https://vcpkg.io/">官网</a></p><h3 id="toc_10">配置教程</h3><p><strong>Step 1: 从 GitHub 克隆 vcpkg</strong></p><pre><code>git clone https://github.com/Microsoft/vcpkg.git
cd vcpkg</code></pre><p>注意vcpkg目录的位置，确保文件路径长度合适以及可以存储较大数据。</p><p><strong>Step 2: 运行 bootstrap</strong></p><pre><code>./bootstrap-vcpkg.bat</code></pre><p><strong>Step 3: 将包自动集成到 vs 的工程中</strong></p><pre><code>./vcpkg integrate install</code></pre><p>之后缺哪个运行库只需在该文件夹打开 powershell 运行 vcpkg 安装指令即可。</p><h3 id="toc_11">常用命令</h3><p>搜索包</p><pre><code>./vcpkg search [packages]</code></pre><p>安装包（输入上面搜出的包名）</p><pre><code>./vcpkg install &lt;pkg&gt;</code></pre><p>查看已安装包列表</p><pre><code>./vcpkg list</code></pre><p>删除包</p><pre><code>./vcpkg remove &lt;pkg&gt;</code></pre><p>帮助</p><pre><code>./vcpkg help</code></pre><p>卸载 vcpkg（并在之后删除此文件夹）</p><pre><code>./vcpkg integrate remove</code></pre><p>举例</p><pre><code>.\vcpkg install eigen3:x64-windows
.\vcpkg install opencv4[contrib]:x64-windows
.\vcpkg install qt5-base:x64-windows</code></pre><h3 id="toc_12">清理空间</h3><p>在文档<code>docs/about/faq.md</code>中提到：</p><pre><code class="lang-markdown">## How can I remove temporary files?

You can save some disk space by completely removing the `packages\`, `buildtrees\`, and `downloads\` folders.</code></pre><p>​    参考 @zhc 笔记，删除<code>buildtrees\</code>可能导致静态库无法调试。</p><h3 id="toc_13">网络问题</h3><p>使用代理服务器进行网络加速时，PowerShell 终端默认不走代理端口。为此可以在 PowerShell 中运行：</p><pre><code>$env:HTTP_PROXY=&quot;localhost:7890&quot;
$env:HTTPS_PROXY=&quot;localhost:7890&quot;</code></pre><p>上述代理服务器端口因设备而异，仅改变本次端口设置。</p><p>如果需要设置全局代理，可在环境变量中设置</p><pre><code>http_proxy         http://127.0.0.1:7890/
https_proxy     http://127.0.0.1:7890/</code></pre><p>CMake 时遇到网络问题：在 CMakeLists.txt 的前面添加如下代码</p><pre><code>set(ENV{http_proxy} &quot;http://127.0.0.1:7890&quot;)
set(ENV{https_proxy} &quot;http://127.0.0.1:7890&quot;)</code></pre><h2 id="toc_14">项目配置</h2><h3 id="toc_15">CMake</h3><p><strong>方法一</strong>：使用 CMake-GUI</p><p>选择源代码位置、build 目录，只需 Configure、Generate、Open Project 三步。</p><p>若出错则需要对应报错信息找错。大部分错误是找不到依赖库。</p><p><strong>方法二</strong>：使用 VS 内置</p><p>新建一个空的 VS 项目，文件-打开-CMake，选中 CMakeLists.txt</p><p>打开CMake设置-高级-CMake生成器-改为VS2022 Win64</p><h3 id="toc_16">注意点</h3><ol><li>请勿新建一个项目，然后将代码文件(.cpp .h等)加入项目，折磨且成功率低</li><li>配置前确认项目可以在win环境生成，如某些依赖库只支持 Linux 系统，需要使用 WSL 生成</li></ol><h3 id="toc_17">字体</h3><p>YaHei Consolas Hybrid 1.12</p><p>Fira Code</p><h3 id="toc_18">命令行参数</h3><p>项目-属性-配置属性-调试-命令行参数</p><h3 id="toc_19">包含目录出错</h3><p>无法打开源文件：fstream</p><p>包含目录只要有一个错的，后面的包含目录都会出错。</p><p>删去不正确的包含目录即可。</p><h2 id="toc_20">Eigen 库使用</h2><p>svd 分解</p><pre><code class="lang-cpp">Eigen::JacobiSVD&lt;Eigen::Matrix3d&gt; svd(J, Eigen::ComputeFullU| Eigen::ComputeFullV);        Eigen::Matrix3d U = svd.matrixU();
Eigen::Matrix3d S = svd.singularValues();
Eigen::Matrix3d V = svd.matrixV();  //J = U * S * V.T</code></pre><h2 id="toc_21">Learn C++</h2><p>学习链接：<a href="https://www.youtube.com/playlist?list=PLlrATfBNZ98dudnM48yfGUldqGD0S4FFb"><strong>The Cherno</strong>的视频系列</a></p><h3 id="toc_22">C++编程基础</h3><p>打开debug模式的代码优化：解决方案属性 - C/C++ - 优化 - 最大优化 、 代码生成 - 基本运行时检查 - 默认</p><p>输出文件 - 汇编程序输出 - 仅有程序集的列表 (/FA)：可在 *.asm 文件查看输出的汇编程序。用这种方法可以查看常量是怎样被优化的。（比如：<code>return 5 * 2</code> 被优化成 <code>mov    eax, 10</code>）</p><p>多行同时输入：alt+鼠标选中位置 或者 alt+shift+方向键</p><p>选中当前单词：鼠标双击 或者 ctrl+W</p><p>调试 - 窗口 - 内存：查看当前内存的内容。把想查看的变量拖到地址区域。（string 能看到一些有趣的内容）</p><p>VS 的输出目录：<code>$(SolutionDir)bin\$(Platform)\$(Configuration)\</code></p><p>VS 多项目 library 使用：解决方案-添加-新建项目(编写lib)  添加附加包含目录  当前项目-添加-引用-选中 library 项目</p><p>高级调试：右键添加<strong>条件</strong>或<strong>操作</strong>，并在输出中查看调试信息。</p><p>预编译头：<em>.cpp 属性 - C/C++ - 预编译头 - 创建； 项目属性 - 预编译头 - 使用； 预编译头文件 - </em>.h</p><p>VS 编译时间查看：选项 - 项目和解决方案 - 生成计时</p><h3 id="toc_23">C++进阶内容</h3><p>类中定义的静态变量：就算创建了多个类元素也共享一个存储空间。</p><p>C++ 防止创建类的实例：将构造函数写为 private。如 <code>class Log { private:Log(); };</code> 或将构造函数写为 <code>Log() = delete;</code></p><p>C++ 初始化列表：采用如下写法 <code>Player(const std::string&amp; name) : m_Name(name){}</code> 。这种方法可以避免重复初始化，以及const常量只能这样初始化。</p><p>虚函数写法：需要继承的类函数添加 virtual 前缀。纯虚函数：参考视频28</p><p>protected : 当前类和派生类可访问到的变量</p><p>new 关键词分配的内存：生存周期直到它被 delete 或者程序终止。</p><pre><code class="lang-cpp">static constexpr int size = 5;
int example[size];  // 如果 size 是 const int 会报错</code></pre><p>std::string 文档：<a href="https://cplusplus.com/reference/string/string/">链接</a></p><p>一些特殊的字符串定义方式：</p><pre><code class="lang-cpp">const wchar_t* chs = L&quot;dhui&quot;;
const char16_t* chs2 = u&quot;dhui&quot;;
const char32_t* chs3 = U&quot;dhui&quot;;
using namespace std::string_literals; //C++14
std::string name0 = &quot;Cherno&quot;s + &quot; hello&quot;; //这种写法允许字符串拼接
const char* name2 = R&quot;(dhui
dhui2)&quot;; //这种写法允许回车</code></pre><p>const int<em> 不可以改变指针指向的内存数据。int</em> const 不可以改变指针让它指向其他东西。</p><p>mutable 变量：在 const 函数中也可以被更改</p><p>explicit 关键字：写在类的构造函数前，不允许隐式类型转换</p><p>std::cout &lt;&lt; 运算符重载：</p><pre><code class="lang-cpp">std::ostream&amp; operator&lt;&lt;(std::ostream&amp; stream, const Entity&amp; other) {
    stream &lt;&lt; other.GetName() &lt;&lt; &quot;, &quot; &lt;&lt; other.GetAge();
}</code></pre><p>智能指针(unique pointer) 与 共享指针(shared pointer) 与 弱指针(weak pointer)</p><pre><code class="lang-cpp">std::unique_ptr&lt;Entity&gt; entity(new Entity());
std::shared_ptr&lt;Entity&gt; shardEntity = std::make_shared&lt;Entity&gt;();
std::weak_ptr&lt;Entity&gt; e0 = shardEntity;</code></pre><p>获取类中的变量的offset：<code>(int)&amp;((Vector3*)0)-&gt;x;</code></p><p>Templete 写法：<code>template&lt;typename T&gt;</code></p><p>C++ 宏：可让代码在不同配置下执行不同的函数，如只让 Debug 模式输出调试信息。 反斜杠 <code>\</code> 用于换行。</p><p>为类型定义新的名称：</p><pre><code class="lang-cpp">using Devicemap = [type];
typedef [type] Devicemap</code></pre><p>auto 关键字：传引用 <code>auto&amp;</code></p><p>函数指针：一种 confusing 的用法</p><pre><code class="lang-cpp">typedef void(*HelloworldFunction)(int); 
HelloworldFunction function = Helloworld;</code></pre><h3 id="toc_24">STL模板库</h3><p>迭代 vector 元素的方法：<code>for (Vertex&amp; v : vertices);</code>  最好传引用</p><p>删除一个 vector 元素：<code>vertices.erase(vertices.begin() + 1);</code></p><p>为 vector 预分配空间 <code>vertices.reserve(3);</code> （有别于resize，之后可以push_back）</p><p>使用 <code>vertices.emplace_back(1, 2, 3);</code> 避免类重新被 copy constructor 构建</p><p>array： <code>std::array&lt;int,5&gt; data;</code> 可以调用 <code>data.size()</code> 函数。在<strong>栈</strong>上开辟内存，而 vector 在<strong>堆</strong>上。</p><p>Lambda 函数：<a href="https://en.cppreference.com/w/cpp/language/lambda">参考</a>。传入函数可能需要 std::function 。部分代码如下</p><pre><code class="lang-cpp">#include &lt;functional&gt;
void print(int value, const std::function&lt;void(int)&gt;&amp; func) { func(value); }
int a = 5; 
auto lambda = [&amp;](int value) { std::cout &lt;&lt; &quot;Value:&quot; &lt;&lt; value &lt;&lt; &quot;\t a=&quot; &lt;&lt; a &lt;&lt; std::endl; };
print(9, lambda);</code></pre><p>std::find_if 的一个应用示例：</p><pre><code class="lang-cpp">std::vector&lt;int&gt; values = { 1, 5, 4, 2, 3 }; 
auto it = std::find_if(values.begin(), values.end(), [](int value) {return value &gt; 3; });</code></pre><p>std::map 与 std::unordered_map：建立两者的关系，类似数组。第一个必须是 hashable 的，如指针，否则要写个 hash 函数。</p><p>遍历 std::map ：若要有序输出，对于第一个变量要有 operator&lt; 函数重载。<a href="https://www.youtube.com/watch?v=KiB0vRi2wlc">视频演示</a></p><pre><code class="lang-cpp">for (auto&amp; [name, city] : cityMap){}  // C++17
for (auto&amp; kv : cityMap){ kv.first; kv.second; } </code></pre><p>std::thread ：分出一个线程干别的事情，并继续后面的代码。</p><pre><code class="lang-cpp">std::thread worker(DoWork);
// Do something
worker.join();</code></pre><p>thread_local 关键字：让每个线程中创建一个实例，互不干扰。</p><p>计时函数 Chrono</p><pre><code class="lang-cpp">auto start = std::chrono::high_resolution_clock::now();
// Do something
auto end = std::chrono::high_resolution_clock::now();
std::chrono::duration&lt;float&gt; duration = end - start;
std::cout &lt;&lt; &quot;Time = &quot; &lt;&lt; duration.count() &lt;&lt; std::endl;</code></pre><p>或者直接构建结构体，用于计时。在需计时的函数中创建变量 <code>Timer timer;</code> 注意 timer 的生存周期。</p><pre><code class="lang-cpp">struct Timer {
    std::chrono::time_point&lt;std::chrono::steady_clock&gt; start, end;
    std::chrono::duration&lt;float&gt; duration;
    Timer() { 
        start = std::chrono::high_resolution_clock::now(); 
    }
    ~Timer() {
        end = std::chrono::high_resolution_clock::now();
        duration = end - start;
        std::cout &lt;&lt; &quot;Timer took = &quot; &lt;&lt; duration.count() * 1000.0f &lt;&lt; &quot;ms&quot; &lt;&lt; std::endl;
    }
};</code></pre><p>std::sort 时间复杂度：$O(NlogN)$</p><p>static_cast / dynamic_cast ：后者会更加安全，涉及类的继承关系时可使用后者。</p><p>多返回值: std::tuple / std::pair (后者仅允许双返回值)</p><pre><code class="lang-cpp">std::tuple&lt;std::string, int&gt; person = { &quot;Cherno&quot;, 24 }; //初始化
std::string&amp; name = std::get&lt;0&gt;(person); //取元素
std::tie(name, std::ignore) = person; //解包</code></pre><p>std::optional (C++17)</p><pre><code class="lang-cpp">std::optional&lt;int&gt; count = {};
if (count.has_value()) {};  // 判断 count 有没有值
int c = count.value_or(100); </code></pre><p>std::variant (C++17)</p><pre><code class="lang-cpp">std::variant&lt;std::string, int&gt; data;
data = &quot;Cherno&quot;;
data.index(); // 判断data的类型</code></pre><p>std::any (C++17) </p><p>std::async 写法较复杂，但可以调试查看每个线程正在执行的任务(调试-&gt;窗口-&gt;并行堆栈) <a href="https://www.youtube.com/watch?v=5HWCsmE9DrE">视频参考</a></p><p>std::string_view 用于读取string数据，而不用初始化string</p><p>benchmarking: 生成 json 文件导入到 <code>chrome://tracing</code> 中， <a href="https://gist.github.com/TheCherno/31f135eea6ee729ab5f26a6908eb3a5e">代码</a></p><p><strong>完结于 2024.6.5</strong>，后续教程 (SINGLETON开始) 基本是 C++20 或是更加进阶的 C++ 技巧，需要用到的时候再针对性学习。</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/24/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>Jellyfin 折腾记录</title>
<link>https://dhui626.github.io/index.php/archives/23/</link>
<guid>https://dhui626.github.io/index.php/archives/23/</guid>
<pubDate>Sat, 28 Oct 2023 16:57:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[运行环境：Windows 10 22H2 x64 + Jellyfin Server 10.8.11介绍Jellyfin官网 + 文档查看官网介绍，本应用是一种媒体存储方案，并附加共享功能，可以...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>运行环境：Windows 10 22H2 x64 + Jellyfin Server 10.8.11</p><h2 id="toc_25">介绍</h2><p><a href="https://jellyfin.org/">Jellyfin官网</a> + <a href="https://jellyfin.org/docs/">文档</a></p><p>查看官网介绍，本应用是一种媒体存储方案，并附加共享功能，可以搭建自己的媒体服务器网络。该应用具有多平台支持，只要有浏览器即可。该软件免费，now and always。</p><h2 id="toc_26">安装</h2><p><a href="https://www.himiku.com/archives/deploy-a-more-comfortable-animation-library-with-jellyfin-and-bangumi.html">利用 Jellyfin + Bangumi 打造更舒适的动画媒体库</a></p><p>安装后的设置可参考如上文章，笔者在安装结束之后才看到本文。</p><p>密码可以留空。</p><p>转码设置默认也行，博客作者建议全部勾选。</p><p><strong>插件安装</strong>：「插件 - 存储库」点击加号，添加如下网址：</p><pre><code>https://jellyfin-plugin-bangumi.pages.dev/repository.json</code></pre><p>然后在「插件 - 目录 - 元数据」找到 Bangumi 插件安装，重启 Jellyfin</p><h2 id="toc_27">媒体库设置</h2><p><strong>动画</strong>：内容类型选择「节目」</p><p>命名规则：将文件名加上 Season 和 Episode 信息。</p><p>示例：</p><pre><code>Shows
├── Series (2010)
│   ├── Season 00
│   │   ├── Some Special.mkv
│   │   ├── Episode S00E01.mkv
│   │   └── Episode S00E02.mkv
│   ├── Season 01
│   │   ├── Episode S01E01-E02.mkv
│   │   ├── Episode S01E03.mkv
│   │   └── Episode S01E04.mkv
│   └── Season 02
│       ├── Episode S02E01.mkv
│       ├── Episode S02E02.mkv
│       ├── Episode S02E03 Part 1.mkv
│       └── Episode S02E03 Part 2.mkv
└── Series (2018)
    ├── Episode S01E01.mkv
    ├── Episode S01E02.mkv
    ├── Episode S02E01-E02.mkv
    └── Episode S02E03.mkv</code></pre><p>重命名教程：</p><p>利用 Renamer Pro 的插入 + 序列化功能。</p><p>@miracle 的建议：不需要重命名，Jellyfin会自动识别。且若文件夹名和种子文件相同，还可以做种。</p><p>但根据测试，季度信息文件夹，如多季度番剧的 S01~S0x 文件夹还是需要创建并拖进相应视频的。 </p><p><strong>电影</strong>：内容类型选择「电影」</p><p>三次元电影 bangumi 索引不到，可以提高 tmdb 的优先级。</p><p>ass 字幕出现方块字：播放 - 备用字体文件路径</p><p><strong>漫画</strong>：内容类型选择「照片」</p><p>添加相应的文件夹后需要手动扫描媒体库，以获得漫画封面信息。</p><p><strong>书籍</strong>：内容类型选择「书籍」</p><p>能识别 epub 但不能识别 txt 文件，需要手动转换。且 epub 不会生成封面。</p><p><strong>音乐</strong>：内容类型选择「音乐」</p><p>建议按专辑建立文件夹存放。</p><h2 id="toc_28">服务器建立</h2><p><a href="http://www.test-ipv6.com/">测试 IPv6 连接</a> </p><p>Jellyfin 联网设置中开启 IPv4, IPv6 功能。</p><p>如果运气很好，网络环境有公网 IPv4，可以用 http://[IPv4地址]:8096/ 访问。</p><p>如果设置得当，网络环境有公网 IPv6，可以用 http://[IPv6地址]:8096/ 访问。</p><p>目前大部分网络没有 IPv4，但支持打开 IPv6，需在路由器中设置。</p><p>而有些学校的宿舍网络并不支持 IPv6，更别说 IPv4 了，有如下两种解决办法：</p><ul><li>使用流量网络（这总支持 IPv6 了吧，不行的话直接 call 运营商总部）</li><li>反向代理</li></ul><p>反向代理设置教程：</p><p><strong>使用 frp</strong>：需要有 VPS（没有，遂搁置）</p><p>教程：<a href="https://sspai.com/post/52523">使用frp进行内网穿透</a>    <a href="https://moe.best/tutorial/frp.html">frp 内网穿透神器搭建 萌新也看得懂的教程系列</a></p><p><strong>使用 SakuraFrp</strong>：</p><p>注册登录下载安装，一气呵成。</p><p>参考教程：<a href="https://doc.natfrp.com/app/http.html">HTTP(S) 协议穿透指南</a></p><p>隧道类型选 TCP，海外节点支持 http 协议，但会经常断线重连，故选择内地节点。</p><p>新建穿透隧道 - 输入本地 ip 和端口 - 选择穿透结点（ping一下）- 创建</p><p>内地节点 + http 无法正常访问：隧道列表 - 编辑 - 打开自动 HTTPS </p><p>Chrome 浏览器会提示连接不安全。</p><p>这不对劲，虽然已经实现目标了，但不安全</p><p><strong>Jellyfin 开启 https 访问</strong>：</p><p>没有 ssl 证书咋整啊？可以自建。<a href="https://blog.csdn.net/qq243920161/article/details/119963501">参考</a></p><p>下载 openssl：<a href="https://slproweb.com/products/Win32OpenSSL.html">Win32/Win64 OpenSSL Installer for Windows - Shining Light Productions</a></p><p>若安装步骤中未勾选 Copy OpenSSL DLLs to: The Windows system directory，需要手动添加环境变量。</p><p>生成私钥文件</p><pre><code>openssl genrsa -des3 -out localhost.key 2048</code></pre><p>去除口令</p><pre><code>openssl rsa -in localhost.key -out localhost.key</code></pre><p>创建请求证书</p><pre><code>openssl req -new -key localhost.key -out localhost.csr</code></pre><p>生成证书</p><pre><code>openssl x509 -req -days 36500 -in localhost.csr -signkey localhost.key -out localhost.crt</code></pre><p>这样就生成了三个文件：</p><pre><code>localhost.crt
localhost.csr
localhost.key</code></pre><p>然后将证书文件转换为 Jellyfin 能读取的 PFX 文件：<a href="https://www.ssldun.com/tools/ssl-converter.php">网站1</a> <a href="https://www.chinassl.net/ssltools/convert-ssl.html">网站2</a></p><p>Jellyfin 控制台 - 联网 - 启用 HTTPS + 自定义 SSL证书路径（选择刚才转换完成的 pfx 文件）。</p><p>但 Chrome 打开网站还是会显示不安全！但至少能用了。</p><p>安全证书颁发方法：使用 Active Directory 证书服务 <a href="https://www.tangyuecan.com/2021/12/17/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E6%90%AD%E5%BB%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%AF%E4%BF%A1%E4%BB%BB%E7%9A%84ssl%E8%AF%81%E4%B9%A6/">教程</a> 。</p><p>参考这篇文章？<a href="https://cloud.tencent.com/developer/article/1705305">本地安排上HTTPS的最佳途径~</a> 暂时搁置。</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/23/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>测试数学公式</title>
<link>https://dhui626.github.io/index.php/archives/6/</link>
<guid>https://dhui626.github.io/index.php/archives/6/</guid>
<pubDate>Sat, 28 Oct 2023 12:49:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[行间公式测试：$$a + \frac{|ac| \vec{n_1}+|ab| \vec{n_2}}{2 sin\theta}$$行内公式测试：其中 $\vec{n_1}$ 和 $\vec{n_2...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p><strong>行间公式测试：</strong></p><p>$$
a + \frac{|ac| \vec{n_1}+|ab| \vec{n_2}}{2 sin\theta}
$$</p><p><strong>行内公式测试：</strong></p><p>其中 $\vec{n_1}$ 和 $\vec{n_2}$ 分别是垂直于 $ab$ 和垂直于 $ac$ 的单位向量，$\theta$ 是 $ab$ 和 $ac$ 的夹角。平移两条垂线组成一个平行四边形易验证外心关系。</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/6/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>个人网站 搭建记录</title>
<link>https://dhui626.github.io/index.php/archives/3/</link>
<guid>https://dhui626.github.io/index.php/archives/3/</guid>
<pubDate>Thu, 26 Oct 2023 15:11:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[个人网站 搭建记录运行环境：Windows 10 22H2软件版本：Apache 2.4 + PHP 8.2.12 + MySQL 8.2.0搭建教程准备安装 Typecho 进行搭建网页测试。...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<h1>个人网站 搭建记录</h1><p>运行环境：Windows 10 22H2</p><p>软件版本：Apache 2.4 + PHP 8.2.12 + MySQL 8.2.0</p><h2 id="toc_29">搭建教程</h2><p>准备安装 Typecho 进行搭建网页测试。下载下来没有html，诶??? php 是什么啊，打开怎么是源码啊。</p><p>此处省略一万字，去学习了静态网页和动态网页的区别。</p><p><strong>安装 php 环境</strong></p><p>首先安装 php 环境，在 Windows 系统下有集成式安装软件 Wampserver，一键安装。</p><p>但是这东西又丑又卡，还不断弹出 cmd 窗口让我觉得是病毒软件，虽然在上面搭建成功了但也反手卸载了。</p><p>不如自己动手安装！</p><p>参考教程：<a href="https://zhuanlan.zhihu.com/p/123960715">记一次windows配置PHP环境</a>。</p><p>难得的优质教程，跟着他的教程来基本没有搜索别的内容了。</p><h3 id="toc_30"><strong>1 安装Apache2.4</strong></h3><p>1.1 Apache 的下载链接 <a href="https://httpd.apache.org/download.cgi">The Apache HTTP Server Project</a></p><p>1.2 点击 a number of third party vendors 下载 windows 版本</p><p>1.3 选择 ApacheHaus</p><p>1.4 选择 x64 的版本下载</p><p>1.5 建立个人主页文件夹 Home，将下载的 apache 解压到其中。</p><p>1.6 用记事本打开 conf 中的 httpd.conf，找到如下代码段</p><pre><code>Define SRVROOT &quot;/Apache24&quot;
ServerRoot &quot;${SRVROOT}&quot;</code></pre><p>将引号内的内容改为 Apache 的路径。</p><pre><code>Define SRVROOT &quot;E:/CloudMusic/VSCode/Home/Apache24&quot;
ServerRoot &quot;${SRVROOT}&quot;</code></pre><p>1.7 更改端口号</p><pre><code>Listen 80</code></pre><p>默认端口号是80，浏览器输入 localhost 就能访问，可以改为其他</p><pre><code>Listen 9700</code></pre><p>1.8 用管理员身份打开 cmd，然后进入 apache 的 bin 路径，用 httpd -k install 进行安装</p><p>1.9 安装完成之后在 /Apache24/bin 中打开 ApacheMonitor.exe 并启用服务。</p><p>1.10 验证安装，在浏览器输入localhost:9700 如果打开 apache 的首页即为安装成功。</p><h3 id="toc_31"><strong>2 安装PHP</strong></h3><p>2.1 下载 PHP8.2，直接到<a href="https://windows.php.net/download">官网</a>下载即可，笔者选择的版本是 VS16 x64 Thread Safe (2023-Oct-24 21:57:24)</p><p>2.2 解压到个人主页文件夹中</p><p>2.3 打开PHP的目录将 php.ini-development 先复制一份备份，然后把 php.ini-development 改为 php.ini 保存</p><p>2.4 打开 php.ini 修改配置，查找</p><pre><code>;extension_dir = &quot;ext&quot;</code></pre><p>改为 extension_dir = "ext的目录"，比如</p><pre><code>extension_dir = &quot;E:/CloudMusic/VSCode/Home/PHP/ext&quot;</code></pre><p>2.5 打开 apache/conf 的 httpd.conf，在 DirectoryIndex 后加上 index.php</p><pre><code>&lt;IfModule dir_module&gt;
    DirectoryIndex index.html index.php
&lt;/IfModule&gt;</code></pre><p>2.6 开启 rewrite 功能：将下面这行代码前面的 # 去掉（httpd.conf中）</p><pre><code>#LoadModule rewrite_module modules/mod_rewrite.so</code></pre><p>2.7 加载PHP模块，在 httpd.conf 中加入以下代码</p><pre><code class="lang-text">#php8
LoadModule php_module E:/CloudMusic/VSCode/Home/PHP/php8apache2_4.dll
&lt;IfModule php_module&gt; 
        PHPIniDir &quot;E:/CloudMusic/VSCode/Home/PHP/&quot; 
        AddType application/x-httpd-php .php
        AddType application/x-httpd-php-source .phps
&lt;/IfModule&gt;</code></pre><p>2.8 验证，注释 apache24/htdocs 中 index.html 的网页代码，输入下边这个输入下边这个 Hello World 代码，然后重命名为 index.php.</p><pre><code class="lang-text">&lt;?php
echo&quot;hello world&quot;
?&gt;</code></pre><p>在电脑浏览器输入 localhost:9700 , 若能正确显示 hello world , 则 php 网页已经能够显示了。</p><h3 id="toc_32"><strong>3 安装mysql</strong></h3><p>3.1 <a href="https://dev.mysql.com/downloads/mysql/">官网下载链接</a>。笔者选择的是 mysql-8.2.0-winx64.msi</p><p>3.2 直接安装的话可能会提示缺少 vs2019 的 redistributable. 到微软官网下载安装 <a href="https://aka.ms/vs/16/release/VC_redist.x64.exe">VC_redist.x64.exe</a></p><p>3.3 以<strong>管理员</strong>身份进入cmd命令行。执行</p><pre><code>cd C:\Program Files\MySQL\MySQL Server 8.2\bin
mysqld.exe --install
mysqld --initialize</code></pre><p>3.4 在 win+r 之后输入 services.msc 进入本地服务管理，启动 mysql 服务。</p><p>3.5 登录需要输入密码。在 C:\Program Files\MySQL\MySQL Server 8.2\data 中后缀名为 err 的文件中找到临时密码，搜索如下字段</p><pre><code>A temporary password is generated for root@localhost: &amp;baRyjS-b5mp</code></pre><p>3.6 输入 mysql -u root -p 和密码进行登录。登录之后修改密码。</p><pre><code class="lang-text"> ALTER USER &#039;root&#039;@&#039;localhost&#039; IDENTIFIED WITH mysql_native_password BY &#039;123456&#039;;</code></pre><p>3.7 输入如下代码创建数据库</p><pre><code>create DATABASE home;</code></pre><h3 id="toc_33"><strong>4 安装typecho</strong></h3><p>4.1 进入 /Apache24/htdocs 目录，将 typecho 解压到此处。在浏览器中打开 localhost:9700</p><p>4.2 安装提示缺少拓展，需要安装所需拓展。将 php.ini 对应的分号去掉即可。</p><pre><code>;extension=mbstring
;extension=openssl
;extension=pdo_mysql</code></pre><p>4.3 继续安装，数据库名称填 home，数据库密码填修改后的密码，其余问题不大。</p><p>4.4 安装完成后登录控制台，可以进行网页管理等操作。</p><p>4.5 第三方主题安装：解压到 /usr/themes ，插件安装：解压到 /usr/plugins ，启用即可。</p><p>4.6 若第三方主题启用失败建议查看 github issue 排查问题。</p><h3 id="toc_34">5 网站设置</h3><p>主题设置可以在 控制台-外观-设置外观 里找到，在此处启用数学公式解析。</p><p>设置-基本设置-站点地址，可以更改站点地址。</p><p><strong>启用https</strong></p><p>如果不关心网站的“不安全”提示，SSL 证书可以暂时不管。</p><p>首先登录 Typecho 后台 -&gt; 设置 -&gt; 基本设置 -&gt; 站点地址改成 https 的域名</p><p>然后编辑 Typecho 站点根目录下的文件<code>config.inc.php</code>加入下面一行配置。</p><pre><code>/** 开启HTTPS */
define(&#039;__TYPECHO_SECURE__&#039;,true);</code></pre><p>然后在站点主题目录下找到<code>comments.php</code>文件，并搜索到<code>$this-&gt;commentUrl()</code>，将其修改为：<code>echo str_replace(&quot;http&quot;,&quot;https&quot;,$this-&gt;commentUrl())</code>，然后点击保存即可。</p><p>在开启 https 之后，网站的所有图片外链都需要修改为 https 外链，否则无法正常加载。</p><p><strong>内网穿透设置</strong></p><p>使用 SakuraFrp，设置本地端口为 443 即可。</p><p>在网站未启用 https 的情况下，开启 “强制 https” 会有 bug，会把 http 请求都转换为 https，一些本地的图片资源链接 <code>http://localhost/xxx</code> 也会被强制转换为 <code>https://dhui626.github.io/xxx</code> ，导致无法正常显示。</p><p>建议图片外链选择 <code>github.io</code> ，作为免费的图床。</p><p>站点地址改成 <code>https://dhui626.github.io</code> 之后，还是会有 bug，在本地能打开网页，但在其他设备打开无法正常显示。需要将站点地址改为内网穿透地址。如笔者的 <code>https://frp-oak.top:56651/</code>。改了之后用 localhost 还是能登陆的，不用担心不小心把内网穿透隧道删除了而再也进不去了的问题。</p><p><strong>首页静态Html生成</strong></p><p>参考 <a href="https://sunpma.com/484.html">Typecho生成首页静态HTML数倍提高网站打开速度</a></p><p>在网站根目录创建一个php文件，重命名为static.php</p><pre><code>&lt;?php
    $nowtime=time();
    $pastsec = $nowtime - $_GET[&quot;t&quot;];
    if($pastsec&lt;600){
      exit; //10分钟更新一次，时间可以自己调整
    }
    ob_start(); //打开缓冲区
    include(&quot;index.php&quot;);
    $content = ob_get_contents(); //得到缓冲区的内容
    $content .= &quot;\n&lt;script language=javascript src=\&quot;static.php?t=&quot;.$nowtime.&quot;\&quot;&gt;&lt;/script&gt;&quot;;
    //加上调用更新程序的代码

    file_put_contents(&quot;index.html&quot;,$content);
    if (!function_exists(&quot;file_put_contents&quot;)){
      function file_put_contents($fn,$fs){
        $fp=fopen($fn,&quot;w+&quot;);
        fputs($fp,$fs);
        fclose($fp);  
      }
    }
?&gt;</code></pre><p>设置网站优先打开 <code>index.html</code> 而不是<code>index.php</code>，即可在每次打开 html 提高速度，且会根据设定的时间间隔更新。</p><p><strong>全站静态Html生成</strong></p><p>参考 <a href="https://ilay.top/p/310.html">typecho全站静态化方案</a> 、 <a href="https://mikuos.com/1130.html">typecho完全静态化</a></p><p>因动态网站部署麻烦，许多站点仅支持静态网站，如 <code>github.io</code> 。本方法可以导出全站的静态html。</p><p>创建以下脚本并命名为<code>staticpass.php</code> .</p><p>上述参考的代码是 Linux 环境下的代码，笔者已将其转化为 Windows 代码。需要手动安装 wget .</p><p>注意 url 是需要爬虫的网页地址，rurl是需要部署静态网页的地址，需要相应修改。</p><pre><code>&lt;?php
$url = &#039;https://dhui626.github.io&#039;; //网址，不能以&quot;/&quot;结尾
$rurl= &#039;&#039;; //要替换成路径或网址，可为空，不能以&quot;/&quot;结尾
$dir = __DIR__ . &quot;/&quot; . str_replace(&#039;https://&#039;, &#039;&#039;, str_replace(&#039;http://&#039;, &quot;&quot;, $url));
exec(&quot;cls&quot;,$clc);
echo $clc[0];
echo &quot;开始下载文件\r\n&quot;;
exec(&quot;RMDIR /S /Q {$dir}&quot;,$return); //小心调用！
exec(&quot;wget --no-check-certificate -r -p -np {$url}&quot;,$return);

$dirs = get_filenamesbydir($dir);

//不处理非html文件
for ($i = 0; $i &lt; count($dirs); $i++) {
    $file=str_replace(__DIR__, &quot;&quot;, $dirs[$i][&#039;file&#039;]);

    if (!preg_match(&quot;/html/&quot;,$file)  ) {
        //删除对应的元素
        echo &quot;\r\n不处理文件:\r\n&quot;;
        echo $file;
        unset($dirs[$i]); 
    }  
}
array_filter($dirs);
sort($dirs);//重新生成索引下标

//网址处理
$count=count($dirs);
for ($i = 0; $i &lt; $count; $i++) {
    // echo $url;
    // echo $rurl;
    $content=str_replace($url,$rurl,file_get_contents($dirs[$i][&#039;file&#039;]));
    // echo $dirs[$i][&#039;file&#039;];
    file_put_contents($dirs[$i][&#039;file&#039;],$content);
    $n=$i+1;
    exec(&quot;cls&quot;,$clc);
    echo $clc[0];
    echo &quot;文件下载完毕\r\n&quot;;
    echo &quot;开始处理文件,共{$count}个文件需要处理,已处理{$n}个\r\n&quot;;
    
}
echo &quot;处理完毕，文件目录：{$dir}\r\n&quot;;

function get_allfiles($path, &amp;$files)
{
    if (is_dir($path)) {
        $dp = dir($path);
        while ($file = $dp-&gt;read()) {
            if ($file !== &quot;.&quot; &amp;&amp; $file !== &quot;..&quot;) {
                get_allfiles($path . &quot;/&quot; . $file, $files);
            }
        }
        $dp-&gt;close();
    }
    if (is_file($path)) {
        $files[] = [&#039;file&#039; =&gt; $path];
    }
}
function get_filenamesbydir($dir)
{
    $files = array();
    get_allfiles($dir, $files);
    return $files;
}</code></pre><p>执行</p><pre><code>cd E:\CloudMusic\VSCode\Home\Apache24\htdocs
php staticpass.php</code></pre><p>注意 "php 绝对目录下的staticpass.php" 代码会在当前目录（如未设置php环境变量就是在php根目录中）创建，而不是站点目录，笔者因为这个愚蠢的问题调试了一个多小时的 bug。</p><p><strong>php代码调试</strong></p><p>参考 <a href="https://developers.weixin.qq.com/community/develop/article/doc/000c688fb7cf502571bf4a5b756c13">vscode调试php（解决vscode远程调试无效的问题）</a></p><p>但因为静态网站转换的代码无问题，暂时不打算研究 php 调试相关的问题。</p><h2 id="toc_35">参考资料</h2><p><strong>博客范例参考链接</strong></p><p><a href="https://hikami.moe/">希卡米 | HiKami</a>：Theme <a href="https://github.com/solstice23/argon-theme">Argon</a> By solstice23</p><p><a href="https://www.himiku.com/">初之音</a>：Powered by <a href="http://typecho.org/">Typecho</a>  Theme <a href="https://blog.imalan.cn/archives/247/">VOID</a></p><p><a href="https://ednovas.xyz/">EdNovas 的小站</a> ：Framework <a href="https://hexo.io/">Hexo</a> Theme <a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></p><p><strong>静态网页模板参考链接（没用上）</strong></p><p><a href="https://freehtml5.co/">FreeHtml5</a></p><p><a href="https://html5up.net/">HTML5 UP</a></p><p><strong>Web开发学习链接</strong></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Learn">mdn web docs</a></p><p>End</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/3/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
<item>
<title>欢迎使用 Typecho</title>
<link>https://dhui626.github.io/index.php/archives/1/</link>
<guid>https://dhui626.github.io/index.php/archives/1/</guid>
<pubDate>Thu, 26 Oct 2023 14:49:00 +0000</pubDate>
<dc:creator>dhui</dc:creator>
<description><![CDATA[如果您看到这篇文章,表示您的 blog 已经安装成功.]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>如果您看到这篇文章,表示您的 blog 已经安装成功.</p>
]]></content:encoded>
<slash:comments>1</slash:comments>
<comments>https://dhui626.github.io/index.php/archives/1/#comments</comments>
<wfw:commentRss>https://dhui626.github.io/index.php/feed/</wfw:commentRss>
</item>
</channel>
</rss>